env:
  NETPANZER_DATADIR: $CIRRUS_WORKING_DIR/data

freebsd_task:
  only_if: "changesIncludeOnly(
    '**.{cpp,hpp,c,h}',
    '**meson.build',
    'setup-build.*',
    'subprojects/*.wrap',
    '.cirrus.yml'
    )"
  name: FreeBSD 13.2
  freebsd_instance:
    image_family: freebsd-13-2

  env:
    CIRRUS_CLONE_SUBMODULES: true

  pkginstall_script:
    - pkg update -f
    - pkg install -y gettext meson ninja physfs pkgconf SDL2 sdl2_mixer sdl2_ttf

  setup_script:
    - ./setup-build.sh _build
  build_script:
    - cd _build && ninja
  test_script:
    - cd _build && meson test --suite=netpanzer -v

arm_task:
  only_if: "changesIncludeOnly(
    '**.{cpp,hpp,c,h}',
    '**meson.build',
    'setup-build.*',
    'subprojects/*.wrap',
    '.cirrus.yml'
    )"
  name: Ubuntu arm64
  arm_container:
    image: andy5995/netpanzer-build-env:jammy
  env:
    CIRRUS_CLONE_SUBMODULES: true
  setup_script:
    - ./setup-build.sh _build
  build_script:
    - cd _build && ninja -v
  test_script:
    - cd _build && meson test --suite=netpanzer -v

macos_task:
  only_if: "changesIncludeOnly(
    '**.{cpp,hpp,c,h}',
    '**meson.build',
    'setup-build.*',
    'subprojects/*.wrap',
    '.cirrus.yml'
    )"
  name: macOS arm64
  macos_instance:
    image: ghcr.io/cirruslabs/macos-ventura-xcode:latest

  env:
    CIRRUS_CLONE_SUBMODULES: true

  pkginstall_script:
    - brew update
    - brew install gettext meson ninja physfs sdl2 sdl2_ttf sdl2_mixer
  setup_script:
    - ./setup-build.sh _build -Dnls=false
  build_script:
    - cd _build && ninja
  test_script:
    - cd _build && meson test --suite=netpanzer -v

